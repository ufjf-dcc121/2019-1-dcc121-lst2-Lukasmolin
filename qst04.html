<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <title>Qst04 - Tabela animais</title>
</head>
<body>
    <div>
        <form name="formAnimal">
            <label>
                Nome do animal: <input type="text" name="especie">
            </label>
            <label>
                Altura: <input type="number" name="altura">
            </label>
            <label>
                Peso: <input type="number" name="peso">
            </label>
            <label>
                Velocidade: <input type="number" name="velocidade">
            </label>
            <label>
                Idade m√°xima: <input type="number" name="idadeMax">
            </label>
            <input type="submit" value="Enviar">
        </form>
    </div>
    <div>
        <table>
            <thead>
                <tr>
                    <th>Especie</th>
                    <th>Altura</th>
                    <th>Peso</th>
                    <th>Velocidade</th>
                    <th>Idade max.</th>
                </tr>                
            </thead>
            <tbody></tbody>
            <tfoot></tfoot>
        </table>
    </div>
    <script>
        var f = new Form()
        var t = new Table()
        f._form.addEventListener('submit', function(e){
            e.preventDefault()
            t.addAnimal(f.geraAnimal())
        })

        //Classe Animal
        function Animal(especie, altura, peso, velocidade, idade){
            this.especie = especie
            this.altura = Number(altura)
            this.peso = Number(peso)
            this.velocidade = Number(velocidade)
            this.idade = Number(idade)
        }

        //Classe Form
        function Form(){
                this._form = document.forms.formAnimal
        }

        Form.prototype.geraAnimal = function(){
            var especie = this._form.especie.value
            var altura = this._form.altura.value
            var peso = this._form.peso.value
            var velocidade = this._form.peso.value
            var idade = this._form.idadeMax.value
            return new Animal(especie, altura, peso, velocidade, idade)
        }

        //Classe Table
        function Table(){
            this._tbody = document.querySelector('table').tBodies[0]
            this._tfoot = document.querySelector('table').tFoot
            this._itens = []
        }

        Table.prototype.addAnimal = function(animal){
            this._itens.push(animal)
            var linha = this._criaLinha(animal)
            this._tbody.appendChild(linha)
            this._calcula()
        }

        Table.prototype._calcula = function(){
            var media = new Animal("", 0, 0, 0, 0)
            var quantidade = 0
            this._itens.forEach(animal => {
                media.altura += animal.altura
                media.idade += animal.idade
                media.peso += animal.peso
                media.velocidade += animal.velocidade
                quantidade++
            });
            media.altura /= quantidade
            media.idade /= quantidade
            media.peso /= quantidade
            media.velocidade /= quantidade
            var linha = this._criaLinha(media)
            if(this._tfoot.hasChildNodes())
                this._tfoot.removeChild(this._tfoot.firstElementChild)
            this._tfoot.appendChild(linha)
        }

        Table.prototype._criaCelula = function(info){
            var cel = document.createElement('td')
            cel.innerText = info
            return cel
        }

        Table.prototype._criaLinha = function(animal){
            var linha = document.createElement('tr')
            linha.appendChild(this._criaCelula(animal.especie))
            linha.appendChild(this._criaCelula(animal.altura))
            linha.appendChild(this._criaCelula(animal.peso))
            linha.appendChild(this._criaCelula(animal.velocidade))
            linha.appendChild(this._criaCelula(animal.idade))
            return linha
        }
    </script>
</body>
</html>